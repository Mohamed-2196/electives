{% extends 'courses/base.html' %}
{% load course_filters %}

{% block title %}Select Courses - {{ elective_type.name }}{% endblock %}

{% block header %}Make Your Selection{% endblock %}

{% block content %}
<a href="{% url 'home' %}" class="back-button">← Back to Home</a>

<div class="info-box">
    <h2>{{ elective_type.name }}</h2>
    <p><strong>Student ID:</strong> {{ student_id }}</p>
    <p>{{ elective_type.description }}</p>
    <p style="color: #10b981; font-size: 0.9rem; margin-top: 0.5rem;">For each course below, indicate your preference level (2 points = prefer, 1 point = willing, 0 points = not willing).</p>
</div>

{% if courses %}
<form method="POST" action="{% url 'submit_selection' elective_type.id %}">
    {% csrf_token %}

    <div class="course-grid">
        {% for course in courses %}
        <div class="course-card">
            <div class="course-header">
                <span class="course-code">{{ course.code }}</span>
                {% if course.total_points %}
                <span class="course-points">{{ course.total_points }} pts</span>
                {% endif %}
                <h3 class="course-title">{{ course.name }}</h3>
                <p class="course-description">{{ course.description }}</p>
            </div>

            <div class="course-details">
                <div class="detail-item">
                    <span class="detail-label">Credits:</span>
                    <span class="detail-value">{{ course.credits }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Level:</span>
                    <span class="detail-value">{{ course.level }}</span>
                </div>
                {% if course.prerequisites %}
                <div class="detail-item">
                    <span class="detail-label">
                        Prerequisites:
                        <span class="info-icon" data-tooltip="Prerequisites&#10;You should have taken the following courses, or you can take them&#10;as your second elective (if they're available as electives).&#10;Lower-level prerequisites can also be taken in the same year.">?</span>
                    </span>
                    <span class="detail-value">{{ course.prerequisites }}</span>
                </div>
                {% endif %}
                {% if course.corequisites %}
                <div class="detail-item">
                    <span class="detail-label">
                        Corequisites:
                        <span class="info-icon" data-tooltip="Corequisites&#10;Same-level courses that must be taken together in the same year.&#10;You should take these as your other elective (if available).">?</span>
                    </span>
                    <span class="detail-value">{{ course.corequisites }}</span>
                </div>
                {% endif %}
                {% if course.exclusions %}
                <div class="detail-item">
                    <span class="detail-label">
                        Exclusions:
                        <span class="info-icon" data-tooltip="Exclusions&#10;Courses that cannot be taken with this module due to content overlap.&#10;If you've taken an excluded course, you cannot take this one.">?</span>
                    </span>
                    <span class="detail-value">{{ course.exclusions }}</span>
                </div>
                {% endif %}
                <div class="detail-item">
                    <span class="detail-label">
                        Mode:
                        <span class="info-icon" data-tooltip="Delivery Mode&#10;• LT: Lead Teaching (on-campus)&#10;• ILR: Independent Learning Route (distance)&#10;• OT: Online Teaching (fully online)">?</span>
                    </span>
                    <span class="detail-value">{{ course.mode }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Assessment:</span>
                    <span class="detail-value">{{ course.assessment }}</span>
                </div>
                {% if course.study_guide_url %}
                <div class="detail-item">
                    <span class="detail-label"></span>
                    <a href="{{ course.study_guide_url }}" target="_blank" class="links">Study Guide →</a>
                </div>
                {% endif %}
                {% if course.course_description_url %}
                <div class="detail-item">
                    <span class="detail-label"></span>
                    <a href="{{ course.course_description_url }}" target="_blank" class="links">Course Description →</a>
                </div>
                {% endif %}
            </div>

            <div class="selection-form">
                <span class="selection-label">Your preference for this course:</span>
                <div class="selection-options">
                    <div class="radio-option">
                        <input type="radio" id="not_willing_{{ course.id }}" name="course_{{ course.id }}" value="not_willing" {% if selections|get_item:course.id == 'not_willing' %}checked{% endif %}>
                        <label for="not_willing_{{ course.id }}">✗ Not Willing to Take (0 pts)</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="willing_{{ course.id }}" name="course_{{ course.id }}" value="willing" {% if selections|get_item:course.id == 'willing' %}checked{% endif %}>
                        <label for="willing_{{ course.id }}">○ Willing to Take (1 pt)</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="prefer_{{ course.id }}" name="course_{{ course.id }}" value="prefer" {% if selections|get_item:course.id == 'prefer' %}checked{% endif %}>
                        <label for="prefer_{{ course.id }}">✓ Prefer to Take (2 pts)</label>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="submit-container">
        <h3>Ready to Submit?</h3>
        <p>Please review your selections before submitting. You can always come back and update them later.</p>
        <button type="submit" class="submit-button">Submit My Selections</button>
    </div>
</form>
{% else %}
<div class="info-box">
    <p>No courses available for this elective type.</p>
</div>
{% endif %}
{% endblock %}
